#!/usr/bin/bash
set -eu
readonly PROG_NAME="$(basename $0)"
readonly VERSION='v0.1.0'
readonly cmd="${1}"
readonly args=${@:2}

function usage() {
  cat <<EOF
Usage: $PROG_NAME [OPTION]... COMMAND [ARGS]...
Execute COMMAND for changes to current directory.

Options:
  -d, --directory PATH   moniter under PATH
  -h, --help             display this help text and exit
  -v, --version          display version information and exit
EOF
}
function version() {
  echo "$VERSION"
}
function moniter() {
  inotifywait \
    --event   'create,delete,modify,move' \
    --exclude '.*\.sw[pox]' \
    --monitor \
    --recursive \
    `pwd`
}
function execute() {
  while read; do
    # ignore continuous notify
    while read -t 0.3; do
      :
    done
    clear
    ${cmd} ${args}
  done
}

moniter | execute

exit 0
